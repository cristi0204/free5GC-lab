MDA component.
Available 2 instances:
1. Gathers metrics from Kafka and stores in Victoriametrics (victoriametric-workload namespace)
2. Can gather metrics from blue boxes (e.g. via data exporters) and store in Kafka. Currently used for Kafka self-monitoring (telegraf-sm namespace)

Helm chart limition to generate proper config file of telegraf for json_v2 format.

config.yaml template can't properly prepare telegraf.conf file for json_v2 format (data_format: "json_v2").
Configuration of this format requires two square brackets in some places (see the comments below).
So the generated file, stored in the config map should be corrected manualy.

    [[inputs.kafka_consumer]]
      brokers = [
        "kafka-cluster-kafka-bootstrap-external-victoriametrics:9092"
      ]
      data_format = "json_v2"
      topics = [
        "metrics"
      ]
      [[inputs.kafka_consumer.json_v2]] #lack of openining and closing bracket in the generated config file
        measurement_name = "usage"
          [[inputs.kafka_consumer.json_v2.field]] #lack of openining and closing bracket in the generated config file
            path = "value"
          [[inputs.kafka_consumer.json_v2.tag]] #lack of openining and closing bracket in the generated config file
            path = "resource"


Currently prepared configuration uses older version of json format (data_format: "json")

Expected json object on the kafka topic:

{"measurement":"usage","resource":"cpu","value":93}

Data can be read with the following command:

curl -G 'http://localhost:8481/select/0/prometheus/api/v1/export' -d 'match={__name__=~"usage_value.*",resource="cpu",host="telegraf-polling-service"}'

Telegraf message format
{"fields":{"cpu-usage":91, "mem-usage":91, "cpu-desc":"description"},"name":"bluebox-system","tags":{"address":"1.2.3.4","server":"bluebox-server","resource":"CPU","event":"CPU overload"},"timestamp":1665861982998}


Configuration generated by helm charts
    [[inputs.kafka_consumer]]
      brokers = [
        "kafka.kafka.svc.cluster.local:9092"
      ]
      data_format = "json_v2"
      topics = [
        "metrics"
      ]
      [inputs.kafka_consumer.json_v2] #lack of openining and closing bracket in the generated config file
        measurement_name_path = "name"
        timestamp_format = "unix_ms"
        timestamp_path = "timestamp"
        timestamp_timezone = "UTC"
          [inputs.kafka_consumer.json_v2.object] #lack of openining and closing bracket in the generated config file
            disable_prepend_keys = "true"
            excluded_keys = "[fields_x]" #quotation marks in wrong places 
            path = "@this"
            tags = "[tags_address tags_host tags_url tags_version tags_topic tags_partition tags_consumergroup tags_quantile tags_le]" #quotation marks in wrong places

Proper configuration
    [[inputs.kafka_consumer]]
      brokers = [
        "kafka.kafka.svc.cluster.local:9092"
      ]
      data_format = "json_v2"
      topics = [
        "metrics"
      ]
      [[inputs.kafka_consumer.json_v2]]
        measurement_name_path = "name"
        timestamp_format = "unix_ms"
        timestamp_path = "timestamp"
        timestamp_timezone = "UTC"
          [[inputs.kafka_consumer.json_v2.object]]
            disable_prepend_keys = "true"
            excluded_keys = ["fields_x"]
            path = "@this"
            tags = ["tags_address", "tags_host", "tags_url", "tags_version", "tags_topic", "tags_partition", "tags_consumergroup", "tags_quantile", "tags_le"]           